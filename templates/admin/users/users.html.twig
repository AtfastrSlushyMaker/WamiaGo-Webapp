{% extends 'back-office/base.html.twig' %}

{% block title %}User Management  - WamiaGo{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/user-management.css') }}">
    <link rel="stylesheet" href="{{ asset('css/pagination.css') }}">
{% endblock %}

{% block content_header %}
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2 align-items-center">
                <div class="col-sm-6">
                    <h1 class="m-0"><i class="fas fa-users mr-3 text-primary"></i>User Management</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right bg-transparent p-0 m-0">
                        <li class="breadcrumb-item"><a href="#" class="text-decoration-none"><i class="fas fa-home mr-1"></i>Home</a></li>
                        <li class="breadcrumb-item active">User Management</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="container-fluid user-management">
        <div class="row mb-4">
            <div class="col-md-12">
                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-gradient-primary text-white mb-4 stat-card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-0 font-weight-bold">Total Users</h5>
                                        <h2 class="mt-2 mb-0" id="total-users-count">-</h2>
                                    </div>
                                    <div class="icon-circle bg-white text-primary">
                                        <i class="fas fa-users fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-flex align-items-center justify-content-between stat-card-footer">
                                <a class="small text-white stretched-link" href="#">View Details</a>
                                <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-gradient-success text-white mb-4 stat-card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-0 font-weight-bold">Active Users</h5>
                                        <h2 class="mt-2 mb-0" id="active-users-count">-</h2>
                                    </div>
                                    <div class="icon-circle bg-white text-success">
                                        <i class="fas fa-user-check fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-flex align-items-center justify-content-between stat-card-footer">
                                <a class="small text-white stretched-link" href="#">View Details</a>
                                <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-gradient-warning text-white mb-4 stat-card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-0 font-weight-bold">Suspended</h5>
                                        <h2 class="mt-2 mb-0" id="suspended-users-count">-</h2>
                                    </div>
                                    <div class="icon-circle bg-white text-warning">
                                        <i class="fas fa-user-clock fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-flex align-items-center justify-content-between stat-card-footer">
                                <a class="small text-white stretched-link" href="#">View Details</a>
                                <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6">
                        <div class="card bg-gradient-danger text-white mb-4 stat-card">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="mb-0 font-weight-bold">Banned Users</h5>
                                        <h2 class="mt-2 mb-0" id="banned-users-count">-</h2>
                                    </div>
                                    <div class="icon-circle bg-white text-danger">
                                        <i class="fas fa-user-slash fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer d-flex align-items-center justify-content-between stat-card-footer">
                                <a class="small text-white stretched-link" href="#">View Details</a>
                                <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card main-card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h3 class="card-title"><i class="fas fa-users-cog mr-2"></i>User Management</h3>
                    <div class="d-flex">
                        <div class="view-toggle btn-group mr-3">
                            <button type="button" class="btn active" id="list-view-btn">
                                <i class="fas fa-list-ul"></i> <span>List</span>
                            </button>
                            <button type="button" class="btn" id="card-view-btn">
                                <i class="fas fa-th-large"></i> <span>Grid</span>
                            </button>
                        </div>
                        <button type="button" class="btn btn-rounded btn-add-user" id="add-user-btn">
                            <i class="fas fa-plus-circle mr-1"></i> Add User
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <!-- Enhanced Search and Filter Bar -->
                <div class="filter-controls">
                    <div class="row align-items-end">
                        <div class="col-lg-4 col-md-6 mb-3 mb-lg-0">
                            <label for="user-search" class="form-label"><i class="fas fa-search mr-1"></i> Search</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="user-search" placeholder="Name, email, phone...">
                                <div class="input-group-append">
                                    <button class="btn btn-primary filter-btn" id="search-btn" type="button">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-2 col-md-3 col-sm-6 mb-3 mb-lg-0">
                            <label for="filter-status" class="form-label"><i class="fas fa-user-shield mr-1"></i> Status</label>
                            <select class="form-control custom-select" id="filter-status">
                                <option value="">All Statuses</option>
                                {% for status in account_statuses %}
                                    <option value="{{ status.value }}">{{ status.value }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-lg-2 col-md-3 col-sm-6 mb-3 mb-lg-0">
                            <label for="filter-role" class="form-label"><i class="fas fa-user-tag mr-1"></i> Role</label>
                            <select class="form-control custom-select" id="filter-role">
                                <option value="">All Roles</option>
                                {% for role in roles %}
                                    <option value="{{ role.value }}">{{ role.value }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-lg-2 col-md-3 col-sm-6 mb-3 mb-lg-0">
                            <label for="filter-verified" class="form-label"><i class="fas fa-check-circle mr-1"></i> Verification</label>
                            <select class="form-control custom-select" id="filter-verified">
                                <option value="">All Users</option>
                                <option value="true">Verified</option>
                                <option value="false">Not Verified</option>
                            </select>
                        </div>
                        
                        <div class="col-lg-2 col-md-3 col-sm-6">
                            <div class="d-flex">
                                <button type="button" class="btn btn-primary filter-btn flex-fill mr-2" id="apply-filters-btn">
                                    <i class="fas fa-filter mr-1"></i> Apply
                                </button>
                                <button type="button" class="btn btn-outline-secondary filter-btn" id="reset-filters-btn">
                                    <i class="fas fa-redo"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- List View -->
                <div id="list-view" class="view-container">
                    <div class="table-responsive">
                        <table class="table users-table" id="users-table">
                            <thead>
                                <tr>
                                    <th class="text-center" width="60">#</th>
                                    <th width="100">User</th>
                                    <th>Contact Info</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th class="text-center" width="150">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- User rows will be dynamically populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Enhanced Pagination -->
                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <div class="text-muted">
                            Showing <span id="showing-results">0</span> of <span id="total-results">0</span> users
                        </div>
                        <div class="pagination-container" data-results-id="showing-results" data-total-id="total-results">
                            <!-- Dynamic pagination will be generated here -->
                        </div>
                        <div class="d-flex align-items-center">
                            <label for="page-size" class="mb-0 mr-2 text-nowrap">Items per page:</label>
                            <select id="page-size" class="form-control form-control-sm" style="width: 70px;">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Card View -->
                <div id="card-view" class="view-container" style="display:none;">
                    <div class="row" id="users-card-container">
                        <!-- User cards will be dynamically populated here -->
                    </div>
                    
                    <!-- Pagination for Card View -->
                    <div class="d-flex justify-content-between align-items-center mt-4">
                        <div class="text-muted">
                            Showing <span id="showing-results-cards">0</span> of <span id="total-results-cards">0</span> users
                        </div>
                        <nav aria-label="User navigation cards">
                            <ul class="pagination pagination-sm">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" tabindex="-1" aria-disabled="true">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                </li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Include the modals with empty forms, they will be populated dynamically -->
    {% include 'admin/users/edit.html.twig' with {'form': form_edit|default(null)} %}
    {% include 'admin/users/new.html.twig' with {'form': form_new|default(null)} %}
    {% include 'admin/users/delete.html.twig' with {'form': form_delete|default(null)} %}
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">Processing...</div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <!-- Pass route URLs to the external JavaScript file -->
    <script>
        // Set route URLs as global variables for the JS file
        window.addUserRouteUrl = "{{ path('admin_user_new') }}";
        window.apiRouteUrl = "{{ path('admin_api_users_list') }}";
        window.userGetUrl = "{{ path('admin_api_user_get', {'id': 'USER_ID'}) }}";
        window.userEditUrl = "{{ path('admin_user_edit', {'id': 'USER_ID'}) }}";
        window.userUpdateUrl = "{{ path('admin_api_user_update', {'id': 'USER_ID'}) }}";
        window.userDeleteUrl = "{{ path('admin_user_delete', {'id': 'USER_ID'}) }}";
        window.userDeleteApiUrl = "{{ path('admin_api_user_delete', {'id': 'USER_ID'}) }}";
        window.userCreateUrl = "{{ path('admin_api_user_create') }}";
    </script>
    <script src="{{ asset('js/user-management.js') }}"></script>
{% endblock %}
